name: MPP 2.0 data cleanup
run-name: üóëÔ∏è MPP 2.0 data cleanup (${{ inputs.environment }})

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to clean test data from'
        required: true
        default: 'STAGE'
        type: choice
        options:
          - STAGE
          - PROD

jobs:
  data_cleanup:
    name: üóëÔ∏è Data cleanup
    uses: ./.github/workflows/cce-common-job-data-cleanup.yml
    with:
      NODE_VERSION: 22.x
      ENVIRONMENT:  ${{ inputs.environment }}
    secrets: inherit

  slack_notification:
    name: üì¨ Slack
    needs: [ data_cleanup ]
    if: ${{ !cancelled() }}
    uses: ./.github/workflows/cce-common-job-slack.yml
    with:
      ENVIRONMENT:            ${{ inputs.environment }}
      CI_PIPELINE_URL:        "https://github.com/${{github.repository}}/actions/runs/${{github.run_id}}"
      STATUS:                 ${{ needs.data_cleanup.result }}
      SLACK_TEMPLATE:         'cleanup has'
      SLACK_TRIGGER:          ${{ github.event_name }}
      SLACK_TRIGGER_USERNAME: ${{ github.triggering_actor }}
    secrets: inherit